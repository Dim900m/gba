<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Pokémon Emulator - ZIP Loader</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #222; color: #eee; }
  #output { margin-top: 20px; }
  #canvas { border: 2px solid #444; background: black; }
</style>
</head>
<body>

<h1>Pokémon Emulator - Load ZIP ROM</h1>
<input type="file" id="zipInput" accept=".zip" />
<div id="output"></div>
<canvas id="canvas" width="160" height="144"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
const zipInput = document.getElementById('zipInput');
const output = document.getElementById('output');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

zipInput.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  output.textContent = 'Loading ZIP...';

  const arrayBuffer = await file.arrayBuffer();
  const zip = await JSZip.loadAsync(arrayBuffer);

  // Find the first .gb or .gbc file
  let romFile = null;
  zip.forEach((relativePath, zipEntry) => {
    if (!romFile && (relativePath.endsWith('.gb') || relativePath.endsWith('.gbc'))) {
      romFile = zipEntry;
    }
  });

  if (!romFile) {
    output.textContent = 'No Game Boy ROM found in ZIP.';
    return;
  }

  output.textContent = 'Extracting ROM: ' + romFile.name;

  const romData = await romFile.async('uint8array');

  output.textContent = `Loaded ROM: ${romFile.name} (${romData.length} bytes)`;

  // Now: pass romData to emulator core
  startEmulator(romData);
});

// Placeholder emulator function
function startEmulator(romData) {
  output.textContent += '\nStarting emulator...';

  // TODO: Integrate a JS GameBoy emulator here
  // For demo, just clear canvas and draw a test pixel:
  ctx.fillStyle = 'black';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = 'lime';
  ctx.fillRect(10, 10, 5, 5);

  // Real implementation:
  // - Instantiate emulator core
  // - Load romData into emulator memory
  // - Run emulation loop with requestAnimationFrame
  // - Render output on canvas
}
</script>

</body>
</html>
