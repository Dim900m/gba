<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTFâ€‘8">
  <title>LeafGreen Emulator</title>
</head>
<body>
  <h1>GBA LeafGreen Emulator</h1>
  <canvas id="screen" width="480" height="320"></canvas>
  <div>
    <input type="file" id="romInput" accept=".gba">
    <button id="pauseBtn">Pause</button>
    <button id="resetBtn">Reset</button>
    <button id="saveBtn">Download Save</button>
    <input type="file" id="loadSave" style="display:none">
  </div>
  <script src="js/util.js"></script>
  <!-- include all GBA.js modules: core.js, arm.js, video.js, audio.js, keypad.js, etc. -->
  <script src="js/gba.js"></script>
  <script>
    const canvas = document.getElementById('screen');
    const emulator = new GameBoyAdvance(canvas);
    const romInput = document.getElementById('romInput');
    const pauseBtn = document.getElementById('pauseBtn');
    const resetBtn = document.getElementById('resetBtn');
    const saveBtn = document.getElementById('saveBtn');
    const loadSave = document.getElementById('loadSave');

    romInput.onchange = async e => {
      const rom = await e.target.files[0].arrayBuffer();
      emulator.loadBios('bios.bin');       // preload BIOS
      emulator.loadRom(rom);               // start game
      emulator.play();
    };
    pauseBtn.onclick = () => emulator.pause();
    resetBtn.onclick = () => emulator.reset();
    saveBtn.onclick = () => {
      const sav = emulator.getSaveData();
      const blob = new Blob([sav], { type: 'application/octet-stream' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'leafgreen.sav';
      a.click();
      URL.revokeObjectURL(url);
    };
    loadSave.onchange = async e => {
      const data = await e.target.files[0].arrayBuffer();
      emulator.loadSaveData(data);
    };
    document.addEventListener('keydown', e => emulator.keyDown(e));
    document.addEventListener('keyup', e => emulator.keyUp(e));
  </script>
</body>
</html>
